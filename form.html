<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="cache-control" content="no-cache">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Práctica lpp</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<div class="container-fluid">
    <form method="POST" action="form.php" name="form">
        <div class="form-group">
            <div class="radio">
                <label>
                    <input class="form-control" name="forma" type="radio">Rectángulo </input>
                </label>
            </div>
            <div class="radio">
                <label>
                    <input class="form-control" name="forma" type="radio">Círculo </input>
                </label>
            </div>
            <div class="radio">
                <label>
                    <input class="form-control" name="forma" type="radio">Elipse </input>
                </label>
            </div>
            <div class="radio">
                <label>
                    <input class="form-control" name="forma" type="radio">Línea </input>
                </label>
            </div>
            <div class="radio">
                <label>
                    <input class="form-control" name="forma" type="radio">Polígono </input>
                </label>
            </div>
            <div class="radio">
                <label>
                    <input class="form-control" name="forma" type="radio">Polilínea </input>
                </label>
            </div>
        </div>
        <hr class="separator"/>
        <div class="formRowRepeatingSection">
            <a href="#" class="btn btn-default" onclick='repetir(".rectangulo")'>Añadir rectángulo</a>
            <a href="#" class="btn btn-default" onclick='repetir(".poligono")'>Añadir polígono</a>
        </div>
        <input name="rectangulos" id="rectangulos" type="text" style="display: none" value="0" />
        <input name="poligonos" id="poligonos" type="text" style="display: none" value="0" />

        <button type="submit" class="btn btn-default">Generar XML</button>

    </form>
</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        currentCount=0;
        newCount=0;
    });

    $(document).on('click', '.borrarElemento', function () {
        $('input[name="' + $(this).parent('div').parent('div').attr('class') + "s" + '"]').attr('value',document.getElementById( $(this).parent('div').parent('div').attr('class') + "s").getAttribute("value")-1);
        $(this).parent('div').parent('div').remove();
        return false;
    });

    function repetirPunto(parentCount) {
        var puntoHtml = [ '<div class="punto_poligono">',
            '<h4>Punto 2</h4>',
            '<hr class="separator"/>',
            '<div class="form-group">',
            '<label for="x_poligono_2">X</label>',
            '<input class="form-control" type="number" name="x2_poligono_1" id="x2_poligono_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="y_poligono_2">Y</label>',
            '<input class="form-control" type="number" name="y2_poligono_1" id="y2_poligono_1" />',
            '</div>',
            '</div>'].join('\n');

        var currentCount = $(".puntos_poligono_" + parentCount).children().length;
        var newCount = currentCount + 1;
        var newParentCount = parentCount + 1;
        var lastRepeatingGroup = $(".punto_poligono").last();
        var newSection = puntoHtml;
        newSection = newSection.replace("x2", "x"+newCount);
        newSection = newSection.replace("y2", "y"+newCount);
        //var lastRepeatingGroup = $(seccion).last();
        lastRepeatingGroup.append(newSection)
       // var newSection = lastRepeatingGroup.clone();
        //newSection.insertAfter(lastRepeatingGroup);
        newSection.find("input").each(function (index, input) {
           // input.id = input.id.replace("_" + currentCount, "_" + newCount);
            //input.id = input.id.replace("x" + currentCount, "x" + newCount);
            //input.id = input.id.replace("y" + currentCount, "y" + newCount);
           // input.name = input.name.replace("_" + currentCount, "_" + newCount);
           // input.name = input.name.replace("x" + currentCount, "x" + newCount);
           // input.name = input.name.replace("y" + currentCount, "y" + newCount);
        });
        newSection.find("label").each(function (index, label) {
            var l = $(label);
            l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
            l.attr('for', l.attr('for').replace("/x" + parentCount + "/g", "x" + newParentCount));
            l.attr('for', l.attr('for').replace("/y" + parentCount + "/g", "y" + newParentCount));
        });
        newSection.find("h4").each(function (index, h4) {
            var h = $(h4);
            h.text(h.text().replace(" " + currentCount, " " + newCount));

        });
    }

    function repetir(seccion) {

        var currentCount = $(seccion).length;
        var newCount = currentCount + 1;

        var rectanguloHtml = [
            ' <div class="rectangulo">',
            '<h3>Rectángulo 1</h3>',
            '<div>',
            '<a href="#" class="btn btn-default borrarElemento">Eliminar rectángulo</a>',
            '</div>',
            '<hr class="separator"/>',

            '<div class="form-group">',
            '<label for="color_rectangulo_1">Color</label>',
            '<input class="form-control" type="text" name="color_rectangulo_1" id="color_rectangulo_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="borde_rectangulo_1">Borde</label>',
            '<input class="form-control" type="number" name="borde_rectangulo_1" id="borde_rectangulo_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="opacidad_rectangulo_1">opacidad</label>',
            '<input class="form-control" type="number" name="opacidad_rectangulo_1" id="opacidad_rectangulo_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="x_rectangulo_1">X</label>',
            '<input class="form-control" type="number" name="x_rectangulo_1" id="x_rectangulo_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="y_rectangulo_1">Y</label>',
            '<input class="form-control" type="number" name="y_rectangulo_1" id="y_rectangulo_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="ancho_rectangulo_1">Ancho</label>',
            '<input class="form-control" type="number" name="ancho_rectangulo_1" id="ancho_rectangulo_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="alto_rectangulo_1">Alto</label>',
            '<input class="form-control" type="number" name="alto_rectangulo_1" id="alto_rectangulo_1" />',
            '</div>',

            '</div>'
        ].join("\n");

        var poligonoHtml = [
            ' <div class="poligono">',
            '<h3>Polígono 1</h3>',
            '<div>',
            '<a href="#" class="btn btn-default borrarElemento">Eliminar polígono</a>',
            '</div>',
            '<hr class="separator"/>',

            '<div class="form-group">',
            '<label for="color_poligono_1">Color</label>',
            '<input class="form-control" type="text" name="color_poligono_1" id="color_poligono_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="borde_poligono_1">Borde</label>',
            '<input class="form-control" type="number" name="borde_poligono_1" id="borde_poligono_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="opacidad_poligono_1">opacidad</label>',
            '<input class="form-control" type="number" name="opacidad_poligono_1" id="opacidad_poligono_1" />',
            '</div>',
            '<div class="puntos_poligono_1">',
            '<div class="punto_poligono">',
            '<div class="formRowRepeatingSection">',
            '<a href="#" class="btn btn-default" onclick=\'repetirPunto('+newCount+')\'>Añadir punto</a>',
            '</div>',
            '<h4>Punto 1</h4>',
            '<hr class="separator"/>',
            '<div class="form-group">',
            '<label for="x_poligono_1">X</label>',
            '<input class="form-control" type="number" name="x1_poligono_1" id="x1_poligono_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="y_poligono_1">Y</label>',
            '<input class="form-control" type="number" name="y1_poligono_1" id="y1_poligono_1" />',
            '</div>',
            '</div>',
            '<div class="punto_poligono">',
            '<h4>Punto 2</h4>',
            '<hr class="separator"/>',
            '<div class="form-group">',
            '<label for="x_poligono_2">X</label>',
            '<input class="form-control" type="number" name="x2_poligono_1" id="x2_poligono_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="y_poligono_2">Y</label>',
            '<input class="form-control" type="number" name="y2_poligono_1" id="y2_poligono_1" />',
            '</div>',
            '</div>',
            '<div class="punto_poligono">',
            '<h4>Punto 3</h4>',
            '<hr class="separator"/>',
            '<div class="form-group">',
            '<label for="x_poligono_3">X</label>',
            '<input class="form-control" type="number" name="x3_poligono_1" id="x3_poligono_1" />',
            '</div>',
            '<div class="form-group">',
            '<label for="y_poligono_3">Y</label>',
            '<input class="form-control" type="number" name="y3_poligono_1" id="y3_poligono_1" />',
            '</div>',
            '</div>',
            '</div>',
            '</div>'].join("\n");



        if ( seccion == ".rectangulo") {
            if (currentCount == 0 ) { // primer rectangulo
                var html = rectanguloHtml;
                $("form").append(html);
                $('input[name="' + seccion.replace(".", "") + "s" + '"]').attr('value', newCount);
            } else { //rectangulo repetido
                var newSection = rectanguloHtml;
                var lastRepeatingGroup = $(seccion).last();
                lastRepeatingGroup.append(newSection)
                $(seccion).last().find("input").each(function (index, input) {
                    input.id = input.id.replace("_" + currentCount, "_" + newCount);
                    input.name = input.name.replace("_" + currentCount, "_" + newCount);
                });
                $(seccion).last().find("label").each(function (index, label) {
                    var l = $(label);
                    l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
                });
                $(seccion).last().find("h3").each(function (index, h3) {
                    var h = $(h3);
                    h.text(h.text().replace(" " + currentCount, " " + newCount));

                });
                $(seccion).last().find("h4").each(function (index, h4) {
                    var h = $(h4);
                    h.text(h.text().replace(" " + currentCount, " " + newCount));

                });
                $('input[name="' + seccion.replace(".", "") + "s" + '"]').attr('value',newCount);
            }

        }
        else if (seccion == ".poligono") {
            if (currentCount == 0) { //primer polígono

                var html = poligonoHtml;
                $("form").append(html);
                $('input[name="' + seccion.replace(".", "") + "s" + '"]').attr('value', newCount);
            } else { //polígono repetido
                var newSection = poligonoHtml;
                var lastRepeatingGroup = $(seccion).last();
                lastRepeatingGroup.append(newSection)
                $(seccion).last().find("input").each(function (index, input) {
                    input.id = input.id.replace("_" + currentCount, "_" + newCount);
                    input.name = input.name.replace("_" + currentCount, "_" + newCount);
                });
                $(seccion).last().find("label").each(function (index, label) {
                    var l = $(label);
                    l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
                });
                $(seccion).last().find("h3").each(function (index, h3) {
                    var h = $(h3);
                    h.text(h.text().replace(" " + currentCount, " " + newCount));

                });
                $(seccion).last().find("h4").each(function (index, h4) {
                    var h = $(h4);
                    h.text(h.text().replace(" " + currentCount, " " + newCount));

                });
                $('input[name="' + seccion.replace(".", "") + "s" + '"]').attr('value',newCount);
                 }

        }
        return false;
    }


</script>
</body>
</html>